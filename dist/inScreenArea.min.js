!function($){"use strict";var id=0;$.fn.inScreenArea=function(options){var $main=this,settings=$.extend({context:$(window),height:"100%",offset:0,elementTolerance:0,debug:!1,debugOptions:{areaBgColor:"rgba(255,216,0, 0.054)",areaOutline:"5px #FFD800 dashed",zIndex:"999",elIdentifier:!0,elIdentifierStyle:{"in":"2px green dotted",out:"2px red dotted"}},onScrollDelay:200,onResizeDelay:200},options);$main.id=id++;var app={areaOffset:0,areaHeight:0,alive:!0,init:function(){this.calcArea(),this.watch(),this.debug.init(),this.destroy()},calcArea:function(){this.areaOffset=this.unitTranslator(settings.offset,settings.context.height()),this.areaHeight=this.unitTranslator(settings.height,settings.context.height())},watch:function(){var e=this;if(e.inArea(),settings.onScrollDelay){var t;settings.context.on("scroll.inScreenArea"+$main.id,function(){t=setTimeout(function(){e.inArea()},settings.onScrollDelay)})}else settings.context.on("scroll.inScreenArea"+$main.id,function(){e.inArea()});e.calcArea();var i;settings.context.on("resize.inScreenArea"+$main.id,function(){i&&clearTimeout(i),i=setTimeout(function(){e.calcArea()},settings.onResizeDelay)})},inArea:function(){var e=this;$main.each(function(){var t=this.getBoundingClientRect(),i=e.positionChecker(t),n={viewport:t,area:i.details},s={offset:e.areaOffset,height:e.areaHeight},a=$(this);a.tolerance=e.elTolerance,i.inArea?(a.trigger("area:in",[a,n,s]),settings.debug&&settings.debugOptions.elIdentifier&&e.debug.setOutline(!0,a)):(a.trigger("area:out",[a,n,s]),settings.debug&&settings.debugOptions.elIdentifier&&e.debug.setOutline(!1,a))})},positionChecker:function(e){this.elTolerance=0,0!=settings.elementTolerance&&(this.elTolerance=this.unitTranslator(settings.elementTolerance,e.height));var t=e.top>=this.areaOffset-this.elTolerance&&e.bottom<=this.areaOffset+this.areaHeight+this.elTolerance;return{inArea:t,details:{fromTop:e.top-this.areaOffset,ratio:Math.round((e.top-this.areaOffset)/this.areaHeight*1e3)/1e3}}},unitTranslator:function(unit,relative){var _this=this;if(unit!==parseInt(unit))if(unit.indexOf("calc")>=0){unit=unit.replace("calc(","").replace(")","");var unitExploded=unit.split(" ");$.each(unitExploded,function(e,t){0==/[+\-*\/]/.test(t)&&(unitExploded[e]=_this.unitTranslator(t,relative))}),unit=eval(unitExploded.join(" "))}else unit=unit.indexOf("%")>=0?relative*(parseInt(unit)/100):parseInt(unit);return Math.round(unit)},debug:{init:function(){if(settings.debug){settings.context.outerHeight()!=$(window).outerWidth()&&console.warn("debugging doesn't work well on windows that aren't fullscreen");var e=$("<div>").css({position:"fixed","z-index":settings.debugOptions.zIndex,width:"100%",height:settings.height,top:settings.offset,left:0,background:settings.debugOptions.areaBgColor,border:settings.debugOptions.areaOutline,"pointer-events":"none"}).addClass("debugger-"+$main.id);$("body").append(e)}},setOutline:function(e,t){e?t.css({outline:settings.debugOptions.elIdentifierStyle["in"],"outline-offset":-4}):t.css({outline:settings.debugOptions.elIdentifierStyle.out,"outline-offset":-4})}},destroy:function(){$main.destroy=function(){settings.context.off(".inScreenArea"+$main.id),$(".debugger-"+$main.id).remove()}}};return app.init(),$main}}(jQuery);